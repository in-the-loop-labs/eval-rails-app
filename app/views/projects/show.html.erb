<%# SPDX-License-Identifier: MIT %>
<% content_for(:title) { "#{@project.name} - TaskFlow" } %>

<div class="mb-4">
  <%= link_to "&larr; Back to Projects".html_safe, projects_path, class: "text-decoration-none" %>
</div>

<div class="d-flex justify-content-between align-items-start mb-4">
  <div>
    <h1>
      <%= @project.name %>
      <span class="badge bg-<%= @project.active? ? 'success' : @project.archived? ? 'secondary' : 'info' %>">
        <%= @project.status.humanize %>
      </span>
    </h1>
    <p class="text-muted">
      Created by <%= @project.user.display_name %> &middot;
      Last updated <%= time_ago_in_words(@project.updated_at) %> ago
    </p>
  </div>

  <% if policy(@project).update? %>
    <div class="btn-group">
      <%= link_to "Edit", edit_project_path(@project), class: "btn btn-outline-secondary" %>
      <% if policy(@project).destroy? %>
        <%= button_to "Delete", project_path(@project), method: :delete,
              class: "btn btn-outline-danger",
              data: { turbo_confirm: "Are you sure you want to delete this project?" } %>
      <% end %>
    </div>
  <% end %>
</div>

<% if @project.description.present? %>
  <div class="card mb-4">
    <div class="card-body">
      <h5 class="card-title">Description</h5>
      <p class="card-text"><%= simple_format(@project.description) %></p>
    </div>
  </div>
<% end %>

<div class="card">
  <div class="card-header d-flex justify-content-between align-items-center">
    <h5 class="mb-0">Tasks</h5>
    <%= link_to "View All Tasks", project_tasks_path(@project), class: "btn btn-sm btn-outline-primary" %>
  </div>
  <div class="card-body">
    <% recent_tasks = @project.tasks.order(created_at: :desc).limit(5) %>
    <% if recent_tasks.any? %>
      <div class="list-group list-group-flush">
        <% recent_tasks.each do |task| %>
          <div class="list-group-item px-0">
            <div class="d-flex justify-content-between align-items-center">
              <div>
                <%= link_to task.title, project_task_path(@project, task) %>
                <span class="badge bg-<%= task.completed? ? 'success' : task.in_progress? ? 'primary' : 'warning' %> ms-1">
                  <%= task.status.humanize %>
                </span>
              </div>
              <small class="text-muted"><%= task.user&.name || "Unassigned" %></small>
            </div>
          </div>
        <% end %>
      </div>
    <% else %>
      <p class="text-muted mb-0">No tasks yet.</p>
    <% end %>
  </div>
</div>
