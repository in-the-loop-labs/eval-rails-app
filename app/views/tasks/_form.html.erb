<%# SPDX-License-Identifier: MIT %>
<%= form_with(model: [project, task], class: "needs-validation") do |f| %>
  <% if task.errors.any? %>
    <div class="alert alert-danger">
      <h5><%= pluralize(task.errors.count, "error") %> prohibited this task from being saved:</h5>
      <ul class="mb-0">
        <% task.errors.full_messages.each do |message| %>
          <li><%= message %></li>
        <% end %>
      </ul>
    </div>
  <% end %>

  <div class="mb-3">
    <%= f.label :title, class: "form-label" %>
    <%= f.text_field :title, class: "form-control #{'is-invalid' if task.errors[:title].any?}",
          placeholder: "Enter task title" %>
    <% if task.errors[:title].any? %>
      <div class="invalid-feedback"><%= task.errors[:title].first %></div>
    <% end %>
  </div>

  <div class="mb-3">
    <%= f.label :description, class: "form-label" %>
    <%= f.text_area :description, class: "form-control #{'is-invalid' if task.errors[:description].any?}",
          rows: 4, placeholder: "Describe the task (optional)" %>
    <% if task.errors[:description].any? %>
      <div class="invalid-feedback"><%= task.errors[:description].first %></div>
    <% end %>
  </div>

  <div class="row mb-3">
    <div class="col-md-6">
      <%= f.label :status, class: "form-label" %>
      <%= f.select :status, Task.statuses.keys.map { |s| [s.humanize, s] },
            {}, class: "form-select" %>
    </div>

    <div class="col-md-6">
      <%= f.label :priority, class: "form-label" %>
      <%= f.select :priority, Task.priorities.keys.map { |p| [p.humanize, p] },
            {}, class: "form-select" %>
    </div>
  </div>

  <div class="mb-3">
    <%= f.label :due_date, class: "form-label" %>
    <%= f.date_field :due_date, class: "form-control" %>
  </div>

  <div class="mb-3">
    <%= f.label :user_id, "Assignee", class: "form-label" %>
    <%= f.select :user_id,
          User.alphabetical.map { |u| [u.display_name, u.id] },
          { include_blank: "Unassigned" },
          class: "form-select" %>
  </div>

  <div class="d-flex gap-2">
    <%= f.submit class: "btn btn-primary" %>
    <%= link_to "Cancel",
          task.persisted? ? project_task_path(project, task) : project_tasks_path(project),
          class: "btn btn-outline-secondary" %>
  </div>
<% end %>
